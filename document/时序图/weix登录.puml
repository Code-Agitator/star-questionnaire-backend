@startuml
小程序 -> 小程序:微信登录获取登录code
小程序 -> 后端:携带code登录
后端 -> 微信服务器:携带code登录
微信服务器 --> 后端:openid session_key
后端 -> 数据库:进行登录
数据库 -> 后端: 放回用户信息
后端 --> 小程序:返回登录信息(登录成功则end)
小程序->小程序: 重新微信登录获取code
小程序 -> 后端: 携带code注册
后端 -> 微信服务器:携带code登录
微信服务器 --> 后端:openid session_key
后端 -> 数据库:校验openid注册
后端 -->小程序:注册结果
小程序 -> 后端:根据第1步进行正常登陆
小程序 -> 后端:保存/绑定手机号(第一次登陆)
后端 -->小程序:绑定结果
小程序 -> 后端:关联微信信息(第一次登陆)
后端 --> 小程序:绑定结果
小程序 -> 小程序:更新缓存

@enduml